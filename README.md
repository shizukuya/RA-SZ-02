# おにぎりパズルゲーム (RA-SZ-02) 仕様書

## プロジェクト概要
物理演算を利用した、おにぎり合体パズルゲームです。
プレイヤーは様々な具材や海苔を落下させ、同じ種類のおにぎりを合体させて進化させていきます。
最終的な目標は、完成したおにぎり（FillingN）同士をマッチさせて消去し、ハイスコアを目指すことです。

## ゲームルール

### 基本ルール
*   画面上部からアイテムを落下させます。
*   同じ種類のアイテムが衝突すると合体し、次の段階へ進化します。
*   アイテムが積み上がり、上部の境界線（デッドライン）を超えて一定時間経過するとゲームオーバーです。

### 進化フロー
1.  **White** (白おにぎり)
2.  **Nori** (海苔)
3.  **Filling** (具材)
4.  **WithNori** (白 + 海苔)
5.  **FillingO** (白 + 具材)
6.  **FillingN** (具材入りおにぎり・完成形)

### マッチングと消去
*   **FillingN** (完成形) 同士が衝突すると、合体せずに**消滅**します。
*   消滅時にスコアが加算され、コンボ数が増加します。
*   コンボが続くと、効果音のピッチが上がり、獲得スコアが増加するなどのボーナスがあります。

### 特殊アイテム
*   **Rock** (岩): お邪魔アイテム。FillingNのマッチング時に破壊されることがあります。
*   **Pickles** (お漬物): 具材同士が合体すると生成されることがあります。

## 実装機能

### 1. ゲームシステム
*   **物理演算**: UnityのRigidbody2Dを使用した自然な挙動。
*   **近接マージ**: 物理衝突だけでなく、距離判定による確実なマージ処理を実装。
*   **スコア & コンボ**: マッチングによるスコア加算とコンボシステム。

### 2. オーディオ & ビジュアル
*   **エフェクト**:
    *   マッチング時（消滅）のパーティクルエフェクト。
    *   コンボ発生時の追加エフェクト。
    *   FillingN生成時の専用エフェクト。
*   **サウンド**:
    *   コンボ数に応じたピッチ（音程）の変化（最大3.0倍）。
    *   FillingN生成時の固定サウンドと具材サウンドのレイヤー再生。
    *   マッチング音の優先再生（他の音を停止）。
    *   UI操作音（設定ボタン、閉じるボタン）。

### 3. UI & 設定
*   **設定パネル**:
    *   BGMとSE（効果音）の音量調節スライダー。
    *   設定内容は `PlayerPrefs` に保存され、次回起動時に維持されます。
    *   パネル表示中はゲームが一時停止（TimeScale = 0）します。
*   **操作性**:
    *   UI（ボタンなど）の上でのタップ操作を無効化し、誤ってアイテムを落下させるのを防止（手動レイキャスト判定）。

## 技術詳細

### 主要スクリプト
*   `SimpleGameManager.cs`: ゲーム全体の管理（スコア、サウンド、設定、エフェクト）。シングルトンパターン。
*   `SimpleItem.cs`: 個々のアイテムの挙動。ステート管理、衝突判定、マージ処理。
*   `SimpleTouchController.cs`: プレイヤーの入力処理。アイテムの落下制御。UI誤操作防止ロジックを含む。
*   `SettingsPanelController.cs`: 設定画面のUI制御。音量変更のイベントハンドリング。
*   `SimpleSpawner.cs`: 次のアイテムの生成管理。
*  衝突がうまくいかない場合、`SimpleItem.cs`の`mergeCheckRadius`の値を調整する

### 開発環境
*   Unity Version: (User Environment)
*   Language: C#
